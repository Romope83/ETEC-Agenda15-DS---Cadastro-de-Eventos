<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewmodels="clr-namespace:CadastroEventosMAUI.ViewModels"
             xmlns:models="clr-namespace:CadastroEventosMAUI.Models"
             x:DataType="viewmodels:EventListViewModel"
             x:Class="CadastroEventosMAUI.Views.EventListPage"
             x:Name="ThisPage"
             Title="Meus Eventos">

    <!-- TitleView com botão verde para adicionar -->
    <Shell.TitleView>
        <Grid ColumnDefinitions="*,Auto" Padding="0,6,6,6">
            <Label Text="Meus Eventos" VerticalOptions="Center" FontSize="Title" />
            <Button Grid.Column="1"
                    Text="+"
                    BackgroundColor="#2ecc71"
                    TextColor="White"
                    WidthRequest="44"
                    HeightRequest="44"
                    CornerRadius="22"
                    Command="{Binding AddEventCommand}" />
        </Grid>
    </Shell.TitleView>

    <Grid RowDefinitions="*,Auto">

        <CollectionView Grid.Row="0"
                        ItemsSource="{Binding Eventos}"
                        SelectionMode="None">

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:EventoModel">
                    <SwipeView>
                        <!-- três colunas: conteúdo, editar, excluir -->
                        <Grid Padding="10" ColumnDefinitions="*,Auto,Auto">
                            <VerticalStackLayout Grid.Column="0">
                                <Label Text="{Binding Nome}" FontSize="Title" />
                                <Label Text="{Binding DataInicio, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                       FontSize="Small" 
                                       TextColor="Gray" />
                            </VerticalStackLayout>

                            <Button Grid.Column="1"
                                    Text="Editar"
                                    Margin="6,0,6,0"
                                    Command="{Binding Source={x:Reference ThisPage}, Path=BindingContext.EditEventCommand}"
                                    CommandParameter="{Binding .}" />

                            <Button Grid.Column="2"
                                    Text="Excluir"
                                    Margin="0,0,0,0"
                                    BackgroundColor="#e74c3c"
                                    TextColor="White"
                                    Command="{Binding Source={x:Reference ThisPage}, Path=BindingContext.DeleteEventCommand}"
                                    CommandParameter="{Binding .}" />
                        </Grid>

                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>

            <CollectionView.EmptyView>
                <Label Text="Nenhum evento cadastrado. Adicione o primeiro!"
                       VerticalOptions="Center" 
                       HorizontalOptions="Center" 
                       Margin="20" />
            </CollectionView.EmptyView>
        </CollectionView>

    </Grid>
</ContentPage>